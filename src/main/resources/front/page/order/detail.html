<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- 引入样式 -->
    <link rel="stylesheet" href="../../plugins/element-ui/index.css">
    <link rel="stylesheet" href="../../styles/common.css" />
    <link rel="stylesheet" href="../../styles/page.css" />
</head>
<body>
    <!-- 开发环境版本，包含了有帮助的命令行警告 -->
    <script src="../../plugins/vue/vue.js"></script>
    <!-- 引入组件库 -->
    <script src="../../plugins/element-ui/index.js"></script>
    <!-- 引入axios -->
    <script src="../../plugins/axios/axios.min.js"></script>
    <script src="../../js/request.js"></script>
    <script src="../../api/company.js"></script>
    <script src="../../api/user.js"></script>
    <script src="../../api/orders.js"></script>
    <script src="../../js/index.js"></script>
    <div class="dashboard-container" id="orderDetail-app">
        <div class="container">
            <el-descriptions title="订单信息" :column="3" border>
                <el-descriptions-item prop="payerName">
                    <template slot="label">
                        <i class="el-icon-user-solid"></i>
                        支付方
                    </template>
                    {{ this.orderData.payerName || '' }}
                </el-descriptions-item>
                <el-descriptions-item prop="receiverName">
                    <template slot="label">
                        <i class="el-icon-s-custom"></i>
                        收款方
                    </template>
                    {{ this.orderData.receiverName || '' }}
                </el-descriptions-item>
                <el-descriptions-item prop="receiverPhone">
                    <template slot="label">
                        <i class="el-icon-phone"></i>
                        收款方联系电话
                    </template>
                    {{ this.orderData.receiverPhone || '' }}
                </el-descriptions-item>
                <el-descriptions-item prop="receiverAddress">
                    <template slot="label">
                        <i class="el-icon-location"></i>
                        收款方联系地址
                    </template>
                    {{ this.orderData.receiverAddress || '' }}
                </el-descriptions-item>
                <el-descriptions-item prop="logisticProviderName">
                    <template slot="label">
                        <i class="el-icon-s-promotion"></i>
                        物流公司
                    </template>
                    {{ this.orderData.logisticProviderName || '' }}
                </el-descriptions-item>
                <el-descriptions-item prop="amount">
                    <template slot="label">
                        <i class="el-icon-s-finance"></i>
                        订单总金额
                    </template>
                    {{ this.orderData.amount || '' }}
                </el-descriptions-item>
                <el-descriptions-item prop="orderStatus">
                    <template slot="label">
                        <i class="el-icon-info"></i>
                        订单状态
                    </template>
                    {{ formatOrderStatus(this.orderData.orderStatus) || '' }}
                </el-descriptions-item>
                <el-descriptions-item prop="orderTime">
                    <template slot="label">
                        <i class="el-icon-s-order"></i>
                        下单时间
                    </template>
                    {{ this.orderData.orderTime | formatLocalDateTime }}
                </el-descriptions-item>
                <el-descriptions-item prop="remark">
                    <template slot="label">
                        <i class="el-icon-s-comment"></i>
                        订单备注
                    </template>
                    {{ this.orderData.remark || '' }}
                </el-descriptions-item>
                <el-descriptions-item prop="goodsList">
                    <template slot="label">
                        <i class="el-icon-s-goods">商品列表</i>
                    </template>
                    <el-descriptions :column="3">
                        <el-descriptions-item label="商品名称" v-for="(item, index) in orderData.goodsList" :key="index">
                            {{ item.name || '' }}
                        </el-descriptions-item>
                        <el-descriptions-item label="数量" v-for="(item, index) in orderData.goodsList" :key="index">
                            {{ item.number || '' }}
                        </el-descriptions-item>
                        <el-descriptions-item label="单价" v-for="(item, index) in orderData.goodsList" :key="index">
                            {{ item.price || '' }}
                        </el-descriptions-item>
                    </el-descriptions>
                </el-descriptions-item>
                <!--<el-descriptions-item prop="goodsList" v-for="item in orderData.goodsList">
                    <template slot="label">
                        <i class="el-icon-s-goods">商品列表</i>
                    </template>
                        {{item.name || ''}}
                        {{item.number || ''}}
                        {{item.price || ''}}
                </el-descriptions-item>-->
            </el-descriptions>
        </div>
    </div>
    <script>
        Vue.filter('formatLocalDateTime', function(value) {
            if (value == null) {
                return ''
            }
            const [year, month, day, hour, minute, second] = value;
            return `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')} ${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}:${second.toString().padStart(2, '0')}`;
        });
        new Vue({
            el: '#orderDetail-app',
            data() {
                return {
                    orderData : {},
                    id : '',
                    user : {},
                    orderId : '',
                }
            },
            computed: {},
            created() {
                const userInfo = window.sessionStorage.getItem('userInfo')
                if (userInfo) {
                    this.user = JSON.parse(userInfo)
                    this.orderId = encodeURIComponent(requestUrlParam('id'))
                    console.log(this.orderId)
                }
                this.init()
            },
            mounted() {
            },
            methods: {
                async init () {
                    const orderRes = await getOrderDetail(this.orderId)
                    if (String(orderRes.code) === '1') {
                        this.orderData = orderRes.data || ''
                        console.log(this.orderData.goodsList)
                    }

                },
                handleQuery() {
                    this.page = 1;
                    this.init();
                },
                formatOrderStatus (value) {
                    const orderStatusMap = {
                        UNPAID: '待支付',
                        PAID: '已支付',
                        UNDELIVERED: '待发货',
                        DELIVERED: '已发货',
                        COMPLETED: '已完成',
                        SHIPPING: '运输中',
                        TO_BE_SIGNED: '待签收',
                        // 添加更多类型的映射关系
                    };
                    return orderStatusMap[value] || '';
                },
            }
        })
    </script>
</body>
</html>